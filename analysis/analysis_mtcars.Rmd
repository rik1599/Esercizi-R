---
output:
  word_document: default
  html_document: default
---

Let us consider the dataframe mtcars, which comprises the fuel
consumption and 10 aspects of design and performance for 32 automobiles
(1970s models). The help file is given below

```{r echo=FALSE, printr.help.sections="format"}
library(moments)
help(mtcars)
```

Describe how to perform a preliminary data analysis on this dataframe,
using suitable R commands.

### Scopo e analisi delle variabili

Si vuole creare un modello statistico di regressione per analizzare i consumi 
medi di alcuni modelli di auto presenti nel dataframe `mtcars`.

La variabile risposta è `mpg` che rappresenta il numero di miglia (americane)
percorse (in media) con un gallone di carburante.

Analizziamo le variabili
```{r}
str(mtcars)
```

Ci sono alcune variabili da convertire
```{r}
mtcars$cyl <- as.integer(mtcars$cyl)
mtcars$hp <- as.integer(mtcars$hp)
mtcars$vs <- factor(mtcars$vs, labels = c("V-shaped", "straight"))
mtcars$am <- factor(mtcars$am, labels = c("automatic", "manual"))
mtcars$gear <- as.integer(mtcars$gear)
mtcars$carb <- as.integer(mtcars$carb)
str(mtcars)
```
```{r}
summary(mtcars)
```

### Distribuzione delle variabili
```{r}
source("./../functions.R", local = knitr::knit_global())

numeric.graph(mtcars, c(1, 3, 4, 5, 6, 7), qqplot = 1)
categorical.graph(mtcars, c(2, 8, 9, 10, 11))
```
#### Osservazioni

-   Non si rilevano particolari outlier se non per hp e qsec che ne hanno uno,
    mentre wt ne presenta due molto vicini al baffo superiore.

-   Per le variabili numeriche si nota una generale assimmetria verso destra
    (più o meno accentuata a seconda della variabile in analisi).

-   Gli indici di curtosi mostrano una buona normalità delle curve per quanto
    riguarda hp, wt e mpg. 
    
-   Nonostante a prima vista qsec sembra la variabile migliore dal punto di vista della
    simmetria e della curtosi, i valori di questi indici sono probabilmente
    influenzati dall'outlier

-   Tra le variabili categoriali si può notare, in generale, una buona distribuzione
    di queste ultime nel dataset.

-   Discorso a parte vale per carb, dove ci sono due valori (estremi) con un 
    campione ciascuno.
    
### Correlazioni tra variabili

### Correlazioni tra la variabile risposta (mpg) e le altre variabili
```{r}
scatterplots.graph(1, c(3, 4, 5, 6, 7, 11), mtcars)
boxplots.graph(1, c(2, 8, 9, 10), mtcars)
```
#### Osservazioni
Dai grafici emergono le seguenti correlazioni con mpg:
    
*   con disp e hp, sembra esserci correlazione, ma non di tipo lineare;
    
*   con wt, sembra esserci una correlazione di tipo lineare;

*   con drat la curva lowess suggerisce una correlazione lineare, 
    tuttavia la distribuzione dei punti suggerisce che probabilmente è molto debole;

*   con cyl, vs e am sembrano esserci correlazioni;
    
*   non sembrano esserci correlazioni con qsec, carb e gear;

### Collinearità tra le variabili
Visto l'elevato numero di variabili esplicative sarebbe in caso di rivolgersi a
esperti del settore per avere le seguenti informazioni:

-   quali sono le variabili di maggiore importanza,

-   quali potrebbero essere le collinearità presenti tra le variabili.


After fitting the model
`fit <- lm(mpg ∼ disp + hp + wt + drat, data=mtcars)`, the following
outputs are obtained by the R commands `summary(fit)` and `plot(fit)`,
respectively.
Describe how to interpret these results, and then suggest how to proceed
with further analyses.

```{r echo=FALSE}
fit <- lm(mpg ~ disp + hp + wt + drat, data=mtcars)
summary(fit)
```
#### Osservazioni

-   Modello con 4 regressori continui e variabile risposta continua

-   L'intercetta è elevata, ma sembra comunque essere coerente con il contesto

-   Alcuni regressori (disp e drat) hanno p-value elevati (maggiori del 5%), 
    quindi probabilmente non sono significativi

-   I p-value di hp e wt sono sufficientemente bassi da rifiutare l'ipotesi nulla,

-   hp e disp hanno coefficiente stimato piuttosto basso, ma ciò potrebbe essere causato
    dalla diversa scala delle variabili.

-   I coefficienti di determinazione $R^2$ e $R^2$ corretto assumono un buon valore
    (poco oltre l'80%), ciò significa che il modello copre una parte significativa di
    variabilità del dataset.
    
-   Il test F suggerisce una buona significatività di tutte le variabili,
    in relazione ai p-value dei regressori, probabilmente c'è qualche collinearità
    tra le variabili.

```{r}
plot(fit, which = c(1:6), lwd=2)
```

#### Osservazioni

-   La curva non è nè lineare, nè parallela alle ascisse, quindi l'ipotesi di linearità
    è violata (c'è qualche regressore che ha effetti non lineari sulla risposta),

-   Sulle code il qq-plot presenta un deciso scostamento rispetto ai quantili teorici,
    l'ipotesi di normalità dei residui è violata
    
-   Dal grafico dei residui standardizzati sembra essere rispettata l'ipotesi di
    omogeneità della varianza dei residui (la curva è abbastanza orizzontale)

-   Dagli ultimi tre grafici risulta che nessun punto ha effetti leva o distanza di
    Cook particolarmente elevati.
    
```{r}
DAAG::vif(fit)
```
L'analisi VIF conferma la presenza di collinearità tra le variabili esplicative
(per disp e wt il fattore VIF è maggiore di 5).


### Suggerimenti per ulteriori analisi

-   utilizzare metodi stepforward e backforward (eliminando o aggiungendo regressori)
    per la scelta di un modello tale che elimini le collinearità (verificabili 
    con la funzione `vif`) e riduca i valori dei p-value.

-   trovato un modello con le caratteristiche di cui sopra, valutare l'utilizzo di
    qualche trasformata per ridurre o eliminare gli effetti non lineari.